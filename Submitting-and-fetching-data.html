<html lang="en">

<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Waylay.io Documentation</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/jquery-ui.css" rel="stylesheet">
    <link href="css/jquery.tocify.css" rel="stylesheet">
    <link href="css/prettify.css" type="text/css" rel="stylesheet" />
        <link href="css/freelancer.css" rel="stylesheet">
    
    <link rel="icon" type="image/png" href="http://www.waylay.io/favicon.png">
    </head>

    <body id="page-top" class="index">
        
        
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top" style="padding: 0;">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
<!--                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>-->
                <a class="navbar-brand" href="http://docs.waylay.io/">docs.waylay.io</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="navigation">
                <ul class="nav navbar-nav navbar-right">
                    <li class="page-scroll selected">
                    <a href="#">Please select</a>
                    </li>
                    <li class="page-scroll">
                        <a href="Waylay-REST-API-documentation.html">REST API</a>
                    </li>
                    <li class="page-scroll">
                        <a href="Plugin-API.html">Sensors & Actuators</a>
                    </li>
                    <li class="page-scroll">
                        <a href="Submitting-and-fetching-data.html">Broker & Storage</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
        
        
        
        
        
        
        <div class="container-fluid">
        <div class="row-fluid" style="margin-top: 60px;">
        <div class="col-sm-3" style=" padding-left: 0; margin-left: -15px;">
        <div id="toc" class="tocify"></div>
        
        </div>
            <div class="col-sm-9"><h1 id="waylay-broker-and-storage">Waylay Broker and Storage</h1>
<p>Waylay Broker url is: <a href="https://data.waylay.io" class="uri">https://data.waylay.io</a></p>
<p>We also have a small <a href="https://data.waylay.io/test">test application</a> that lets you play with the different options.</p>
<h2 id="posting-messages-towards-broker">Posting messages towards Broker</h2>
<p>The waylay data endpoint lets you store and distribute messages. This can be performed over different protocols: <a href="#http">http</a>, <a href="#websockets">websockets</a> or <a href="#mqtt">mqtt</a>.</p>
<p>By default the data is publicly available. It can be read by anybody. This is mainly to ease testing.</p>
<p>To keep your data private you use your waylay api key and secret + you provide the domain where you normally access the waylay system. This will also enable the forwarding of your data to your tasks or buckets.</p>
<p>A submitted message is defined by 3 things</p>
<ul>
<li><code>domain</code> this identifies your waylay account, eg <code>sandbox.waylay.io</code> (not needed for public data)</li>
<li><code>resource</code> this is the identifier of the thing the submitted data is coming from (phone, car, person, server, …)</li>
<li><code>payload</code> the content of the message, this can be any key-value pair and as most of the time provided as a json object. eg: <code>{&quot;temp&quot;:21, &quot;humidity&quot;: 0.35}</code></li>
</ul>
<p>For instance, the resource can be the <code>phone</code> and the parameters something like <code>temperature, humidity, acceleration</code> etc.</p>
<h2 id="http-rest-api"><a name="http"></a> HTTP REST API</h2>
<p>The REST API is mainly intended for devices that have an HTTP stack available and don’t need to send huge amounts of data. It also allows you to fetch the current and last 100 items from the store.</p>
<h3 id="anonymous">Anonymous</h3>
<h4 id="posting-data-to-storage">Posting data to storage</h4>
<pre><code>curl -i \
    -H &quot;Content-Type: application/json&quot; \
    -X POST \
    -d &#39;{&quot;foo&quot;:123,&quot;bar&quot;:&quot;hello&quot;}&#39; \
    http://localhost:9000/resources/testresource</code></pre>
<h3 id="authenticated">Authenticated</h3>
<p>First you will need to fetch your API key from the profile page.</p>
<h4 id="posting-data-to-storage-1">Posting data to storage</h4>
<pre><code>curl -i \
    --user apiKey:apiSecret \
    -H &quot;Content-Type: application/json&quot; \
    -X POST \
    -d &#39;{&quot;foo&quot;:123, &quot;bar&quot;:&quot;hello&quot;}&#39; \
    http://localhost:9000/resources/testresource?domain=sandbox.waylay.io</code></pre>
<p>or</p>
<pre><code>curl -i \
    --user apiKey:apiSecret \
    -H &quot;Content-Type: application/json&quot; \
    -X POST \
    -d &#39;{&quot;foo&quot;:123, &quot;bar&quot;:&quot;hello&quot;, &quot;domain&quot;:&quot;sandbox.waylay.io&quot;}&#39; \
    http://localhost:9000/resources/testresource</code></pre>
<h2 id="websockets"><a name="websockets"></a> Websockets</h2>
<p>The websocket API is mainly meant for sending huge amounts of data, like connecting other brokers to the waylay data endpoint.</p>
<p>The <a href="https://data.waylay.io/test">test application</a> lets you play with websocket support.</p>
<p>Endpoint to connect to:</p>
<p><code>wss://data.waylay.io/socket</code></p>
<p>or authenticated</p>
<p><code>wss://data.waylay.io/socket?domain=sandbox.waylay.io</code> with HTTP BASIC authentication using your waylay API key and secret</p>
<p>The endpoint allows you to submit messages in JSON format.</p>
<pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">&quot;resource&quot;</span><span class="fu">:</span> <span class="st">&quot;car_1ABC123&quot;</span><span class="fu">,</span>
  <span class="dt">&quot;engine_temp_c&quot;</span><span class="fu">:</span> <span class="dv">80</span><span class="fu">,</span>
  <span class="dt">&quot;doors_locked&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span>
  <span class="er">...</span>
<span class="fu">}</span></code></pre>
<p>When submitting invalid data you will get a response back with an error message.</p>
<pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Json parse error&quot;</span><span class="fu">,</span>
  <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="ot">[</span>
    <span class="st">&quot;/resource &lt;- String value expected&quot;</span>
  <span class="ot">]</span>
<span class="fu">}</span></code></pre>
<h2 id="mqtt"><a name="mqtt"></a> MQTT</h2>
<p>The MQTT API is mainly used by low-end devices that are not able to use the other protocols because of the lack of power or memory.</p>
<blockquote>
<p>Currently MQTT is not secured and only allows the storage of publicly accessible data. Forwarding to the waylay engine is thus also missing.</p>
</blockquote>
<p>To connect to the waylay mqtt endpoint use this url: <code>tcp://data.waylay.io:1883</code></p>
<p>There are 2 ways to send messages:</p>
<p>topic <code>/global.waylay.io/testresource</code> with a message body</p>
<pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">&quot;engine_temp_c&quot;</span><span class="fu">:</span> <span class="fl">80.2</span><span class="fu">,</span>
  <span class="dt">&quot;doors_locked&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span>
  <span class="er">...</span>
<span class="fu">}</span></code></pre>
<p>topic <code>/global.waylay.io/testresource/engine_temp_c</code> with a message body</p>
<pre class="sourceCode json"><code class="sourceCode json"><span class="er">80.2</span></code></pre>
<p>There is no way to provide feedback so use the http api to see if your messages are stored!</p>
<h2 id="retrieving-data">Retrieving data</h2>
<p>You can always retrieve up to the last 100 data points for every resource over the REST calls. Coming back to the example where resource is the phone, waylay platform would store 100 data points, where each data point would hold information about underlying parameters (temperature, humidity etc.)</p>
<h3 id="anonymous-1">Anonymous</h3>
<h4 id="getting-latest-value-from-storage">Getting latest value from storage</h4>
<pre><code>curl -i http://localhost:9000/resources/testresource/current</code></pre>
<h4 id="getting-history-from-storage">Getting history from storage</h4>
<pre><code>curl -i http://localhost:9000/resources/testresource/series</code></pre>
<h3 id="authenticated-1">Authenticated</h3>
<h4 id="getting-latest-value-from-storage-1">Getting latest value from storage</h4>
<pre><code>curl -i \
    --user apiKey:apiSecret \
    http://localhost:9000/resources/testresource/current?domain=sandbox.waylay.io</code></pre>
<h4 id="getting-history-from-storage-1">Getting history from storage</h4>
<pre><code>curl -i \
    --user apiKey:apiSecret \
    http://localhost:9000/resources/testresource/series?domain=sandbox.waylay.io</code></pre>
<a href="#" class="scrollup"><a href="http://docs.waylay.io/"></a></a>

</div>
        </div>
                </div>
     <footer class="text-center">

        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-xs-9 pull-right">
                        Copyright &copy; waylay.io 2015
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.tocify.min.js"></script>
    <script src="js/prettify.js"></script>
    <script src="js/tinynav.min.js"></script>
    <script src="js/freelancer.js"></script>
</body>

</html>

